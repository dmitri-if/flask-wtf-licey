{% extends "base.html" %}

{{ title }}
{% block head %}
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    .carousel-container {
        position: relative;
        width: 600px;
        max-width: 100%;
        margin: auto;
        overflow: hidden;
        border: 2px solid #ccc;
        border-radius: 8px;
    }

    .slides {
        display: flex;
        transition: transform 0.5s ease-in-out;
    }

    .slide {
        min-width: 100%;
        box-sizing: border-box;
    }

    .slide img {
        width: 100%;
        display: block;
    }

    /* Кнопки навигации */
    .prev, .next {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(0,0,0,0.5);
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        border-radius: 50%;
        font-size:24px;
        line-height:24px;
    }

    .prev { left:10px; }
    .next { right:10px; }
    </style>
    </head>
{% endblock %}

{% block content %}
    <h4>И на Марсе будут яблони цвести!</h4>
    <h1>Пейзажи Марса</h1>
    <div class="carousel-container">
    <div class="slides" id="slides">
        <!-- Начальные изображения -->
        <div class="slide"><img src="/static/img/mars1.jpeg" alt="Изображение"></div>
        <div class="slide"><img src="/static/img/mars2.jpeg" alt="Изображение"></div>
        
    </div>

    <button class="prev" id="prevBtn">&#10094;</button>
    <button class="next" id="nextBtn">&#10095;</button>
    </div>

    <!-- Форма для добавления новых изображений через файл -->
    <div style="margin-top:20px; text-align:center;">
    <h3>Добавить изображение из файла</h3>
    <input type="file" id="fileInput" accept="image/*" />
    <button type="button" class="btn btn-primary" id="addFileBtn">Добавить</button>
    </div>

    <script>
    const slidesContainer = document.getElementById('slides');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const addFileBtn = document.getElementById('addFileBtn');
    const fileInput = document.getElementById('fileInput');

    let currentIndex =0;

    function updateSlide() {
        const totalSlides = slidesContainer.children.length;

        if (totalSlides===0) return;

        // Циклический переход
        if (currentIndex >= totalSlides) currentIndex=0; // при выходе за правый край — возвращаемся к первому
        if (currentIndex<0) currentIndex= totalSlides -1; // при выходе за левый — к последнему

        const offset = -currentIndex *100; // в процентах
        slidesContainer.style.transform= `translateX(${offset}%)`;
    }

    // Навигация по слайдам с циклом
    prevBtn.addEventListener('click', ()=> {
        currentIndex--;
        updateSlide();
    });

    nextBtn.addEventListener('click', ()=> {
        currentIndex++;
        updateSlide();
    });

    // Обработка добавления изображения из файла
    addFileBtn.addEventListener('click', ()=> {
        const files = fileInput.files;
        if (files.length ===0) {
            alert("Пожалуйста, выберите файл");
            return;
        }
        const file = files[0];

        if (!file.type.startsWith('image/')) {
            alert("Пожалуйста, выберите изображение");
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const slideDiv= document.createElement('div');
            slideDiv.className='slide';

            const img= document.createElement('img');
            img.src= e.target.result; // Data URL изображения
            img.alt='Новое изображение';

            slideDiv.appendChild(img);
            slidesContainer.appendChild(slideDiv);

            currentIndex= slidesContainer.children.length -1; // перейти к новому изображению
            updateSlide();

            fileInput.value='';
        };
        reader.readAsDataURL(file);
    });
</script>
{% endblock %}